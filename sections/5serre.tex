\section{Serre duality}
The rest of this paper is devoted to proving the Serre duality.
I will prove the theorem by first finding a more concrete representation of
$H^{1}(X,\mathcal{L}(D))$ and then constructing a perfect pairing between
$H^{1}(X,\mathcal{L}(D))$ and $\diffs{D}$,
which will give us the isomorphism.

\subsection{Concrete representation of $H^{1}(X,\mathcal{L}(D))$}
To prove the Serre duality, we do not want to directly work with the \v Cech
cohomology definition of $H^{1}(X,\mathcal{L}(D))$.
Instead we want to give a more concrete description of
$H^{1}(X,\mathcal{L}(D))$ by finding some SES involving $\mathcal{L}(D)$
and then taking the cohomology sequence of the SES. Since $\mathcal{L}(D)$ is
a subsheaf of the constant sheaf $\underline{k(X)}$, one can simply consider
the following SES.
\[
  \begin{tikzcd}
    0\rar & \mathcal{L}(D)\rar & \underline{k(X)}\rar
    & \underline{k(X)}/\mathcal{L}(D)\rar & 0,
  \end{tikzcd}
\]
which yields the following exact sequence
\[
  \begin{tikzcd}
    H^{0}(X,\underline{k(X)})\rar & H^{0}(X,\underline{k(X)}
    /\mathcal{L}(D))\rar & H^{1}(X,\mathcal{L}(D))\rar
    & H^{1}(X,\underline{k(X)}).
  \end{tikzcd}
\]
But Prop.~\ref{prop:const_sheaf} implies that
$H^{0}(X,\underline{k(X)})=k(X)$ and $H^{1}(X,\underline{k(X)})=0$
so that the exact sequence simplifies to
\begin{equation}\label{eq:repartition_ses}
  \begin{tikzcd}
    k(X)\rar & H^{0}(X,\underline{k(X)}/\mathcal{L}(D))\rar
    & H^{1}(X,\mathcal{L}(D))\rar & 0.
  \end{tikzcd}
\end{equation}
Let us first try to understand the space
$H^{0}(X,\underline{k(X)}/\mathcal{L}(D))$. An element of the space
is of the form $([f_{P}])_{P\in X}$, where $[f_{P}]$ is the equivalence
class of some $f_{P}\in k(X)$ modulo $\mathcal{L}(D)_{P}$.
These elements are actually quite simple, because one can show that the
components $[f_{P}]$ are zero almost everywhere.
% TODO: Add picture with curve X and section f \in H^0(X,k(X)/L(D)) above it.
In other words, we can write $H^{0}(X,\underline{k(X)}/\mathcal{L}(D))$ as a
direct sum of stalks.
\begin{lemm}
  For a divisor $D$ on a curve $X$, the following equality holds.
  \[
    H^{0}(X,\underline{k(X)}/\mathcal{L}(D))=\bigoplus_{P\in X}
    k(X)/\mathcal{L}(D)_{P}.
  \]
\end{lemm}
\begin{proof}
  I will first show the inclusion in forward direction:
  \[
    H^{0}(X,\underline{k(X)}/\mathcal{L}(D))\subseteq\bigoplus_{P\in X}
    k(X)/\mathcal{L}(D)_{P}.
  \]
  I need to check that the components $[f_{P}]$ of some
  $([f_{P}])_{P\in X}\in H^{0}(X,\underline{k(X)}/\mathcal{L}(D))$ are non-zero
  for only finitely many $P\in X$. Thus, suppose $([f_{P}])_{P\in X}\in
  H^{0}(X,\underline{k(X)}/\mathcal{L}(D))$. Firstly, the divisor $D$ is
  non-zero only at finitely many points. The components $[f_{P}]$ may or may
  not be zero at those points, but I can ignore those points in any case
  since there are finitely many of them. Thus, assume $P$ is a point where
  $D(P)=0$. At such a point, the stalk $\mathcal{L}(D)_{P}$ is equal to the
  ring of germs with non-negative order at $P$, which is of course the ring
  $\mathscr{O}_{X,P}$. Now, it is a basic result in algebraic geometry that
  a rational function $f\in k(X)$ on a curve $X$ has negative order only
  at finitely many points so that $f_{P}\in\mathscr{O}_{X,P}$ for almost
  all points $P$. Therefore, we see that $[f_{P}]=0$ for almost all points
  $P$.
  % TODO: Insert a picture of the plane with points where the section
  %       might be non-zero.

  Next I show the inclusion in the reverse direction:
  \[
    H^{0}(X,\underline{k(X)}/\mathcal{L}(D))\supseteq\bigoplus_{P\in X}
    k(X)/\mathcal{L}(D)_{P}.
  \]
  Thus, let $([f_{P}]_{P\in X})\in\displaystyle\bigoplus
  k(X)/\mathcal{L}(D)_{P}$. I want to show that the components $[f_{P}]$
  form a global section of $\underline{k(X)}/\mathcal{L}(D)$. Let us
  fix an arbitrary point $P\in X$. I want to find an open neighbourhood
  $U\ni P$ and a section $g\in k(X)$ such that $\forall Q\in U,\ [f_{Q}]=[g]$.
  If I denote by $P_{1},\ldots,P_{r}$ the points where $D$ is non-zero
  and by $Q_{1},\ldots,Q_{s}$ the points where the $f_{Q_{i}}$ have negative
  order, then there are two cases:
  \begin{description}[style=nextline]
    \item[$P\not\in\set{P_{1},\ldots,P_{r},Q_{1},\ldots,Q_{s}}\big)$]
          Since $P$ is none of the points $P_{1},\ldots,P_{r}$,
          $\mathcal{L}(D)_{P}$ consists of all functions $f\in k(X)$
          with non-negative order at $P$: $\ord_{P}(f)\geq 0$.
          Since $P$ is non of the points $Q_{1},\ldots,Q_{s}$,
          $f_{P}\in\mathscr{O}_{X,P}$. Therefore, $f_{P}\in\mathcal{L}(D)_{P}$
          so that $[f_{P}]=[0]$. Now, if we let $U$ be the complement of
          the set $\set{P_{1},\ldots,P_{r},Q_{1},\ldots,Q_{s}}$, we see
          that $[f_{Q}]=[0]$ for every $r_{Q}$ on $U$ so that we can simply
          choose $0\in k(X)$ as the section on the open neighbourhood $U$.
    \item[$P\in\set{P_{1},\ldots,P_{r},Q_{1},\ldots,Q_{s}}\big)$]
          First, denote $Y=\set{P_{1},\ldots,P_{r},Q_{1},\ldots,Q_{s}}
          \setminus \set{P}$ and $g=f_{P}\in k(X)$. Next, let
          $S_{1},\ldots,S_{t}$ be the points where the $g_{S_{i}}$ have
          negative order. Then, let $U$ be the complement of
          $Y\cup \set{S_{1},\ldots,S_{t}}$. As above, $[f_{Q}]=[0]$ for all
          $Q\in U$ except for $Q=P$. But since the points $S_{i}$ are also
          included in the complement, $[g]=[0]$ away from $P$. Thus,
          $[f_{Q}]=[g]$ on $U$.
  \end{description}
\end{proof}
This direct sum can be expressed in the following way. Consider the
vector space $R$ of families $\{r_{P}\}_{P\in X}$, where $r_{P}\in k(X)$ and
$r_{P}\in\mathscr{O}_{X,P}$ for almost all points $P\in X$.
(Serre calls such a family a \emph{r\'epartition} in \cite{serre}).
Then, define $R(D)=\set{\{r_{P}\}_{P\in X}\mid \ord_{P}(r_{P})\geq -D(P)}$.
It is clear that we have the following isomorphism.
\[
  \bigoplus_{P\in X}k(X)/\mathcal{L}(D)_{P}\cong R/R(D).
\]
Note that r\'epartitions are easier to work with, because the components
$f_{P}$ of some section $(f_{P})_{P\in X}$ of
$\underline{k(X)}/\mathcal{L}(D)$ must be related together so that the
sections satisfy sheaf axioms, whereas there is no such requirement for
r\'epartitions. Therefore, I will make use of r\'epartitions in the rest
of the section.

Now we can return to the SES \eqref{eq:repartition_ses} derived above and
replace $H^{0}(X,\underline{k(X)}/\mathcal{L}(D))$ by $R/R(D)$:
\[
  \begin{tikzcd}
    k(X)\rar & R/R(D)\rar & H^{1}(X,\mathcal{L}(D))\rar & 0.
  \end{tikzcd}
\]
This exact sequence finally gives us the representation of the first
cohomology group: The second map of the sequence is a surjection
onto $H^{1}(X,\mathcal{L}(D))$. The space $k(X)$ can be seen as a subspace
of $R$ and it is thus the kernel of the map. Such a surjection maps $R/R(D)$
onto the space $R\,/\left(R(D)+k(X)\right)$, and thus we get the isomorphism
\[H^{1}(X,\mathcal{L}(D))\cong R/\left(R(D)+k(X)\right).\]
Now, the dual space $\dual{D}$ is simply the space
of linear functionals on $R$, which vanish on $R(D)$ and $k(X)$.

\subsection{Constructing a pairing}
Next I will construct a bilinear form
\[
  \langle -,-\rangle:\diffs{D}\times H^{1}(X,\mathcal{L}(D))\to k.
\]
Recall that the space $\diffs{D}$ consists of differential forms $\omega$
such that $(\omega)\geq D$. Now, define the bilinear form as follows.
\[
  \langle\omega,r\rangle=\sum_{P\in X}\res_{P}(r_{P}\omega),
\]
where $r=[\{r_{P}\}_{P\in X}]\in R\,/\left(R(D)+k(X)\right)$. I must check
that the map is well-defined: only finitely many terms of the sum can be
non-zero, and its value must be independent of the representation modulo
$R(D)+k(X)$.

Firstly, $\res_{P}(r_{P}\omega)$ can be non-zero only when $P$ is a point
such that $D(P)\neq 0$ or $r_{P}\not\in\mathscr{O}_{X,P}$. Otherwise,
$r_{P},f\in\mathscr{O}_{X,P}$, if we write $\omega=f\,dt$ where $t$ is a
local uniformiser at $P$. This clearly implies that the coefficients of the
terms of negative degree in the series expansion of $r_{P}f$ are all zero.
Secondly, given a repartition $r\in R(D)$, we have $(r_{P}\omega)
=(r_{P})+(\omega) \geq -D+D=0$ and thus $\res_{P}(r_{P}\omega)=0$ by the same
% TODO: Make this part more clear.
argument as above. Also, if $r\in k(X)$, then $\langle \omega,r\rangle=0$ by
the residue theorem (Thm.~\ref{thm:residue_theorem}).

Now, Serre duality will follow if we can show that the map
\[
  \iota_{D}:\diffs{D}\to \dual{D}
  :\omega\mapsto\langle\omega,-\rangle
\]
is a bijection. Every differential $\omega\in\diffs{D}$ is indeed mapped
to elements of \linebreak $\dual{D}$ since they vanish on $R(D)$ and $k(X)$
by the arguments in the previous pragraph. In the proof of the bijectivity of
$\iota_{D}$, I will diverge little bit from the proof given by Serre, and
I mix in ideas from the proof given in \cite{forster}.

I will proceed to prove the bijectivity of $\iota_{D}$. The proof relies
on the observation that the spaces $\dual{D}$ and $\diffs{D}$ form so called
\emph{filtered families}, which are tied together by $\iota_{D}$. In the
proofs of injectivity and surjectivity we will ``move through the
filtration'' to derive the wanted results. Thus, let us make the following
observation. For any two divisors $D_{1}, D_{2}$ such that $D_{1}\geq D_{2}$,
we have $R(D_{1})\supseteq R(D_{2})$. Therefore, a linear functional
vanishing on $R(D_{1})$ will also vanish on $R(D_{2})$ so that
$H^{1}(X,\mathcal{L}(D_{1}))^{\vee}\subseteq H^{1}(X,\mathcal{L}(D_{2}))^\vee$.
One can also see that if $D_{1}\geq D_{2}$, then $\diffs{D_{1}}
\subseteq\diffs{D_{2}}$. Moreover, these inclusions trivially
commute with $\iota_{\bullet}$ so that the following square is commutative.
\begin{equation}\label{eq:iota_square}
  \begin{tikzcd}[column sep=large]
    \dual{D_{1}}\rar[hook, shorten=.7em, "i_{D_{1}}^{D_{2}}"] & \dual{D_{2}} \\
    \diffs{D_{1}}\uar{\iota_{D_{1}}}\rar[hook]
    & \diffs{D_{2}}\uar["\iota_{D_{2}}"']
  \end{tikzcd}
\end{equation}
\begin{cat}
  The commutativity of this square shows that the maps $\iota_{\bullet}$
  define a natural transformation between the contravariant functors
  \[
    \diffs{-},\dual{-}:\Div(X)\to k\textbf{-Vect},
  \]
  where $\Div(X)$ is the posetal category of divisors on $X$.
  Thus, not only do we get an isomorphism of the vector spaces
  $\diffs{D}$ and $\dual{D}$, but we also get a natural isomorphism
  between the functors $\diffs{-}$ and $\dual{-}$.
\end{cat}

Now, the following lemma will let us ``transport the problem along the
filtration''.
\begin{lemm}\label{lemm:invert_inclusion}
  Suppose $D_{1}$ and $D_{2}$ are two divisors on $X$ such that
  $D_{1}\geq D_{2}$. Furthermore, let $\lambda\in\dual{D_{1}}$ and
  $\omega\in\diffs{D_{2}}$. If $i_{D_{1}}^{D_{2}}(\lambda)
  =\iota_{D_{2}}(\omega)$, then $\omega\in\diffs{D_{1}}$ and
  $\iota_{D_{1}}(\omega)=\lambda$.
\end{lemm}
This lemma is effectively saying that if we can invert $\lambda$
along $\iota_{D_{2}}$, then we can invert it along $\iota_{D_{1}}$, when
$D_{1}\geq D_{2}$.
\begin{proof}
  Assume to the contrary that $\omega\not\in\diffs{D_{1}}$. Then,
  there is a point $P\in X$ such that $\ord_{P}(\omega)<D_{1}(P)$.
  Now we can construct a r\'epartition $r=\{r_{Q}\}_{Q\in X}$ such that
  $r_{Q}=0$ when $Q\neq P$ and $r_{P}=1/t^{\ord_{P}(\omega)+1}$, where $t$ is a
  local uniformiser at $P$. We have $r\in R(D_{1})$, because
  \[
    \ord_{P}(r_{P})=-\ord_{P}(\omega)-1>-D_{1}(P)-1
    \implies \ord_{P}(r_{P})\geq -D_{1}(P).
  \]
  Then,
  \[
    \lambda(r)=i_{D_{1}}^{D_{2}}(r)=\iota_{D_{2}}(\omega)(r)
    =\sum_{Q\in X}\res_{Q}(r_{Q}\omega)=\res_{P}(r_{P}\omega).
  \]
  Since $\ord_{P}(r_{P}\omega)=\ord_{P}(r_{P})+\ord_{P}(\omega)
  =-\ord_{P}(\omega)-1+\ord_{P}(\omega)=-1$, we have that $\lambda(r)$ is
  non-zero. Therefore, $\lambda$ doesn't vanish on $R(D_{1})$, which
  contradicts the assumption that $\lambda\in\dual{D_{1}}$.
\end{proof}
Injectivity of $\iota_{D}$ follows easily from this lemma.
\begin{prop}\label{prop:injectivity}
  The map $\iota_{D}:\diffs{D}\to \dual{D}$ is an injection.
\end{prop}
\begin{proof}
  The map is injective if its kernel is trivial. Thus, suppose
  $\iota_{D}(\omega)=0$. Since $0\in\dual{D^{\prime}}$ for every divisor
  $D^{\prime}$, $\omega\in\diffs{D^{\prime}}$ for every divisor $D^{\prime}$
  such that $D^{\prime}\geq D$ by the above lemma. This clearly implies that
  $\omega$ must be zero.
\end{proof}

Proving surjectivity is not quite as easy. Let us fix an element $\lambda
\in\dual{D}$. I want to find a suitable divisor $D^{\prime}$ with
$D^{\prime}\leq D$ such that it is easy to invert $\lambda$ along
$\iota_{D^{\prime}}$. But first I will introduce an extra degree of freedom,
which I can work with. Namely, I consider an arbitrary element $\psi\in
H^{0}(X,\mathcal{L}(\Delta))$ for some divisor $\Delta$. This section induces
a map
\[H^{1}(X,\mathcal{L}(D-\Delta))\to H^{1}(X,\mathcal{L}(D))
:[\{r_{P}\}_{P\in X}]\mapsto [\{\psi r_{P}\}_{P\in X}].\]
It is easy to check that this map is well-defined. Then, the dual map
\[\dual{D}\to\dual{D-\Delta}\]
is defined so that $(\psi f)(r) =f(\psi r)$. Note that $\frac1{\psi}
\in H^{0}(X,\mathcal{L}((\psi)))$,
and it induces a map $\dual{D-\Delta}\to\dual{D-\Delta-(\psi)}$ in the same
way. If I now take $D^{\prime}=H^{1}(X,\mathcal{L}(D-\Delta-(\psi)))$,
the inclusion $i_{D}^{D^{\prime}}:\dual{D}\to\dual{D^{\prime}}$ can be
factored as follows.
\[\begin{tikzcd}[row sep=large]
    \dual{D}\rar["\psi\cdot"]\drar["i_{D}^{D^{\prime}}"']
    & \dual{D-\Delta}\dar["\frac1{\psi}\cdot"] \\ & \dual{D-\Delta-(\psi)}
  \end{tikzcd}\]
Now, I will prove a result analogous to Lemma~\ref{lemm:invert_inclusion},
which lets us ``move along these maps'' induced by elements of
$H^{0}(X,\mathcal{L}(D))$.
\begin{lemm}\label{lemm:invert_multiplication}
  Suppose $D_{1}$ and $D_{2}$ are two divisors on $X$ and $\psi
  \in H^{0}(X,\mathcal{L}(D_{2}))$. Then, the following square commutes.
  \[\begin{tikzcd}[column sep=large]
      \dual{D_{1}}\rar[shorten=.3em,"\psi\cdot"] & \dual{D_{1}-D_{2}} \\
      \diffs{D_{1}}\rar["\psi\cdot"']\uar["\iota_{D_{1}}"]
      & \diffs{D_{2}}\uar["\iota_{D_{2}}"']
    \end{tikzcd}\]
\end{lemm}
\begin{proof}
  Let $\omega\in\diffs{D_{1}}$ and $r\in H^{1}(X,\mathcal{L}(D_{1}-D_{2}))$.
  Then,
  \begin{align*}
    \left(\psi\circ\iota_{D_{1}}\right)(\omega)(r)
    &= \langle \omega, \psi r\rangle \\
    &= \sum_{P\in X}\res(\psi r_{P}\cdot\omega) \\
    &= \langle \omega\psi, r\rangle=\left(\iota_{D_{2}}\circ\psi\right)
      (\omega)(r).
  \end{align*}
  Since this equality holds for every $\omega$ and $r$, we have
  $\psi\circ\iota_{D_{1}}=\iota_{D_{2}}\circ\psi$.
\end{proof}

Now I will invert $\psi\lambda$ along $\iota_{D-\Delta}$, which will finally
let us prove the surjectivity of $\iota_{D}$.
\begin{lemm}\label{lemm:invert_iota}
  Let $\lambda\in\dual{D}$. Then, there is a divisor $\Delta$,
  a section $\psi\in H^{0}(X,\mathcal{L}(\Delta))$ and a differential
  $\omega\in\diffs{D-\Delta}$ such that $\psi\lambda
  =\iota_{D-\Delta}(\omega)$.
\end{lemm}
\begin{proof}
  Let $\Delta$ be an arbitrary divisor. The elements $\psi\lambda$ form a
  subspace
  \[
    \Lambda=\Set{\psi\lambda\mid\psi\in H^{0}(X,\Delta)}
  \]
  of $\dual{D-\Delta}$. I will use a dimensional argument to show that
  $\Lambda$ must interesect with $\im(\iota_{D-\Delta})$. Therefore,
  let us first find a bound for the dimension of $\Lambda$. Consider the map
  \[H^{0}(X,\Delta)\to\dual{D-\Delta}:\psi\mapsto\psi\lambda.\]
  \begin{claim}
    This map is an injection.
  \end{claim}
  {\renewcommand{\qedsymbol}{$\blacksquare$}
    \begin{proof}
      Assume for a contradiction that the kernel of this map is non-trivial
      so that there is some non-zero $\psi\in H^{0}(X,\Delta)$ such that
      $\psi\lambda=0$. Note that the multiplication map
      \[
        H^{1}(X,\mathcal{L}(D-\Delta))\to H^{1}(X,\mathcal{L}(D))
        :[\{r_{P}\}_{P\in X}]\mapsto [\{\psi r_{P}\}_{P\in X}]
      \]
      is clearly surjective since for a repartition
      $[\{r_{P}\}_{P\in X}]\in H^{1}(X,\mathcal{L}(D))$, we have
      $[\{1/\psi\cdot r_{P}\}_{P\in X}]\in H^{1}(X,\mathcal{L}(D-\Delta))$.
      Thus, the dual map
      \[\psi\cdot:\dual{D}\to\dual{D-\Delta}\]
      is an injection. But this is a contradiction, because we also have that
      $\psi\cdot 0=0$. Therefore, the kernel of the map
      $H^{0}(X,\Delta)\to\dual{D-\Delta}$ is trivial, and hence the map is
      injective.
    \end{proof}
  }

  Now, this claim implies that $\dim\Lambda=h^{0}(X,\Delta)$, and I can apply
  the cohomological version of the Riemann-Roch theorem to get a bound
  \begin{equation}\label{eq:lambda_dimension}
    \dim\Lambda\geq \deg{\Delta}-g+1.
  \end{equation}
  Similarly, since $\iota_{D-\Delta}:\diffs{D-\Delta}\to\dual{D-\Delta}$
  is an injection, we have that
  \[
    \dim\left(\im(\iota_{D-\Delta})\right) =\dim(\diffs{D-\Delta}).
  \]
  Using Lemm.~\ref{lemm:diffs_dim}, I can apply Riemann-Roch again:
  \begin{equation}\label{eq:im_dimension}
    \dim\left(\im(\iota_{D-\Delta})\right)
    =h^{0}(X,\mathcal{L}((\omega)-D+\Delta))\geq \deg((\omega)-D+\Delta)-g+1.
  \end{equation}
  Of course, I can also apply Riemann-Roch to $\mathcal{L}(D-\Delta)$
  to get $h^{0}(X,\mathcal{L}(D-\Delta))-h^{1}(X,\mathcal{L}(D-\Delta))
  =\deg(D-\Delta)-g+1$. Since $\Delta$ was an arbitrary divisor, I can
  choose it so that $\deg\Delta >\deg D$. Then the zeroth cohomology
  group vanishes and we are left with
  \begin{equation}\label{eq:fst_dimension}
    h^{1}(X,\mathcal{L}(D-\Delta))=\deg(\Delta)-\deg D+g-1.
  \end{equation}
  Combining inequalities \eqref{eq:lambda_dimension} and
  \eqref{eq:im_dimension}, we get the following:
  \[
    \dim\Lambda+\dim\left(\im(\iota_{D-\Delta})\right)
    \geq 2\deg(\Delta)-\deg D+\deg(\omega)-2g+2.
  \]
  Again, since $\Delta$ was arbitrary, we can make its degree large enough
  so that
  \[
    \dim\Lambda+\dim\left(\im(\iota_{D-\Delta})\right)
    \geq h^{1}(X,\mathcal{L}(D-\Delta)).
  \]
  Now, since the sum of the dimensions of these two subspaces is larger
  than the total space, they must intersect.
\end{proof}
Combining all these lemmas, the surjectivity of $\iota_{D}$ follows.
\begin{prop}\label{prop:surjectivity}
  The map $\iota_{D}:\diffs{D}\to \dual{D}$ is a surjection.
\end{prop}
\begin{proof}
  Fix an element $\lambda\in\dual{D}$. Then, by Lemma~\ref{lemm:invert_iota},
  there is a section $\psi\in H^{0}(X,\mathcal{L}(\Delta))$ and a differential
  $\omega\in\diffs{D-\Delta}$ such that $\psi\lambda=\iota_{D-\Delta}(\omega)$.
  Then,
  \[\lambda=\frac1{\psi}(\psi\lambda)=\frac1{\psi}\iota_{D-\Delta}(\omega),\]
  and by Lemma~\ref{lemm:invert_multiplication}, this is
  \[\lambda=\iota_{D-\Delta-(\psi)}(\frac1{\psi}\omega).\]
  Finally, Lemma~\ref{lemm:invert_inclusion} implies that
  $\frac1{\psi}\omega\in\dual{D}$ and that $\iota_{D}(\frac1{\psi}\omega)
  =\lambda$, concluding the proof.
\end{proof}
\begin{cat}
  This proof boils down to chasing the following diagram.
  \[\begin{tikzcd}[column sep=-2em]
    & {\dual{D-\Delta}} \\
    {\dual{D}} && {\dual{D-\Delta-(\psi)}} \\
    & {\diffs{D-\Delta}} \\
    {\diffs{D}} && {\diffs{D-\Delta-(\psi)}}
    \arrow["\psi\cdot", from=2-1, to=1-2]
    \arrow["{\frac1{\psi}\cdot}", from=1-2, to=2-3]
    \arrow["\iota_D", from=4-1, to=2-1]
    \arrow["{\iota_{D-\Delta}}"{description, pos=0.7}, from=3-2, to=1-2]
    \arrow["\iota_{D-\Delta-(\psi)}"', from=4-3, to=2-3]
    \arrow[hook, crossing over, from=2-1, to=2-3]
    \arrow[hook, from=4-1, to=4-3]
    \arrow["\psi\cdot", from=4-1, to=3-2]
    \arrow["{\frac1{\psi}\cdot}", from=3-2, to=4-3]
  \end{tikzcd}\]
\end{cat}

We finally arrive at the Serre Duality theorem!
\begin{thm}[Serre Duality]\label{thm:serre}
  If $X$ is an algebraic curve as in the previous section
  and $D$ is a divisor on $X$, there is an isomorphism
  \[
    \dual{D}\cong\diffs{D}
  \]
  of $k$-vector spaces.
\end{thm}
\begin{proof}
  Combining Propositions \ref{prop:injectivity} and \ref{prop:surjectivity}
  shows that the linear map
  \[\iota_{D}:\diffs{D}\to \dual{D}\]
  is a bijection so that it defines an isomorphism between the two spaces.
\end{proof}
